
# 1、什么是docker？

docker作为一个轻量级的容器，可以将用用户的应用程序和相关依赖打包在一起，在不同的环境中进行运行。

容器是镜像的运行时。

特点：
1）轻量级
2）隔离性
3）可移植性
4）能够快速部署
5）有效利用硬件资源

有哪些组件：

1.  Docker守护进程（Docker daemon）：Docker的核心组件，运行在主机上，用于管理Docker容器和镜像。
2.  Docker客户端（Docker client）：命令行工具，可以通过Docker API与Docker守护进程交互，实现对容器和镜像的管理操作。
3.  Docker镜像（Docker image）：Docker镜像可以包含一个操作系统和用户的应用程序和依赖。
4.  Docker容器（Docker container）：Docker镜像的运行实例，不同容器相互隔离。
5.  Docker仓库（Docker registry）：用于存储Docker镜像的中央存储库。可以是公共的或私有的。

# 2、docker相对于虚拟机的特点

现对于虚拟机而言：
1.  更加轻量级：Docker 直接运行在宿主机的操作系统上，不需要额外的虚拟化层，因此更加轻量级，启动更快，占用资源更少。
2.  扩展、部署、迁移高效：Docker 的镜像和容器机制可以实现快速部署、迁移和扩展，避免了虚拟机镜像庞大、启动缓慢的问题。
3.  更易于管理：Docker 的镜像和容器机制可以快速复制和共享，可以通过版本控制等方式进行管理，更易于管理。
4.  更容易应用自动化部署：Docker 可以轻松地与自动化部署工具集成，如 Kubernetes、Jenkins 等，可以方便地实现应用自动化部署和管理。

# 3、docker与虚拟机的不同点在哪里

1.  实现方式不同：虚拟机是通过虚拟化技术，将一台物理机划分为多个虚拟机，并在每个虚拟机上运行一个完整的操作系统，每个虚拟机都有自己的磁盘、内存、CPU等资源。而 Docker 则是通过容器化技术，在一个操作系统上创建多个独立的容器，在每个容器中运行应用程序，容器之间共享操作系统内核，但是彼此之间相互隔离。
    
2.  运行环境不同：由于虚拟机是运行完整的操作系统，因此它需要较多的系统资源才能运行，如 CPU、内存和磁盘空间等。而 Docker 则是在宿主操作系统上运行，它不需要额外的系统资源，启动速度也更快。同时，由于容器之间共享操作系统内核，因此容器的体积通常比虚拟机的镜像要小很多。
    
3.  部署方式不同：虚拟机通常需要先安装操作系统，然后再安装应用程序等依赖库，比较繁琐。而 Docker 则可以使用 Dockerfile 文件来描述应用程序的部署方式，然后使用 Docker 引擎进行构建和部署，更加简单方便。
    
4.  管理方式不同：由于容器化技术的出现，Docker 的容器可以轻松地创建、销毁、复制、移动等，具有很高的可移植性和可扩展性，因此更方便进行应用程序的管理和维护。而虚拟机则需要进行更加复杂的管理操作，如创建、启动、停止、挂载磁盘等，相对来说更加繁琐。

# 4、docker镜像和容器的区别

Docker 镜像是应用程序和其依赖项的静态快照，包括文件系统、环境变量和运行时配置等。
容器是镜像的运行时，是一个独立的运行环境，可以运行在任何一个支持docker的环境中。

# 5、docker镜像是什么？依托什么原理实现？

Docker 镜像包含了完整的文件系统，包括代码、依赖库、运行时环境等。
Docker 镜像的实现原理主要是使用了 UnionFS（联合文件系统）。在 UnionFS 中，多个不同位置的文件系统挂载到同一个目录下，这些不同的文件系统层组成了一个文件系统的堆栈，最终呈现给用户的是一个统一的文件系统。

Docker Image 是有一个层级结构的，最底层的 Layer 为 BaseImage（一般为一个操作系统的 ISO 镜像），然后顺序执行每一条指令，生成的 Layer 按照入栈的顺序逐渐累加，最终形成一个 Image。DockerFile 中的每一条命令的执行结果都会成为 Image 中的一个 Layer。

# 6、dockerfile中最常见的命令

-   FROM：指定基础镜像，该镜像将作为新镜像的基础。
-   RUN：在镜像中运行命令。
-   COPY/ADD：将文件或目录复制到镜像中。
-   WORKDIR：设置镜像中程序运行的默认工作目录
-   ENV：设置环境变量。
-   EXPOSE：声明镜像中运行的应用程序将使用的端口。
-   CMD/ENTRYPOINT：指定容器启动时运行的命令或应用程序。

# 7、COPY和ADD

1、copy只支持将本地的文件copy到目录下，而ADD还支持将远程或者本地的tar文件。
2、 在COPY时，文件的源文件路径必须相对于Dockerfile文件的位置，而在ADD时则没有此要求。
但是copy命令容易理解，一般都使用copy命令。

# 8、docker的执行流程

1.  创建镜像文件，包括创建基础镜像和构建用户自定义的镜像。
2.  通过容器启动镜像，创建运行容器并挂载到宿主机上。
3.  通过 Docker 守护进程启动容器中的进程。
4.  用户可以通过容器的 IP 地址和端口号等信息来访问运行在容器内的服务。


# 9 在生产环境中如何监控docker

docker 提供的docker stats和事件等工具用来监控生产中docker的运行情况。

常见的 Docker 监控工具包括 cAdvisor、Prometheus、Grafana 等，这些工具都可以通过 Docker 事件来获取容器和守护进程的状态信息，并将这些信息以可视化的方式呈现出来，方便用户进行监控和管理。


# 10 docker的原理核心

namespace，命名空间
命名空间，容器隔离的基础，保证A容器看不到B容器.
6个命名空间：User，Mnt，Network，UTS，IPC，Pid

cgroups，Cgroups 是 Control Group 的缩写，控制组
cgroups 容器资源统计和隔离

主要用到的cgroups子系统：cpu，blkio，device，freezer，memory

实际上 Docker 是使用了很多 Linux 的隔离功能，让容器看起来像一个轻量级虚拟机在独立运行，容器的本质是被限制了的 Namespaces，cgroup，具有逻辑上独立文件系统，网络的一个进程。

unionfs 联合文件系统
典型：aufs/overlayfs，分层镜像实现的基础


# 11 docker守护进程的作用

作用：负责docker的运行、管理、监控
1）管理和监控 Docker 容器、镜像、网络和数据卷等资源。
2）它负责与 Docker 的客户端通信，并响应客户端的请求，如启动、停止、删除容器等操作。
3）守护进程还会处理 Docker 的网络连接和 Docker 镜像的构建、拉取和推送等操作。
4）守护进程还会根据容器配置的不同，在宿主机上创建或管理容器的命名空间、文件系统、进程等资源



# 12、docker 网络

docker的网络模式

1、birdge模式

容器拥有自己的network namespace，在docker进程启动时，会在主机上创建一个名为docker0的虚拟网桥，这个虚拟网桥为每个容器分配IP，同时docker0的IP为容器的默认网关，负责打通容器与其他容器或者宿主机进行网络通信。
2、host模式
容器与主机在相同的网络命名空间下面，使用相同的网络协议栈，容器可以直接使用主机的所有网络接口。容器将不会虚拟出自己的网卡，配置自己的 IP 等，而是使用宿主机的 IP 和端口。但是，容器的其他方面，如文件系统、进程列表等还是和宿主机隔离的。

3、Container 模式
这个模式指定新创建的容器和已经存在的一个容器共享一个 Network Namespace。但是其他的namespce是隔离的。

4、none模式


# 13、数据持久化

为了让数据脱离容器持久保存，Docker 提供了两个选项来将文件持久存储在主机中： `volume` 和 `bind mount` 。



