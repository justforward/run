
# 范式

第一范式：确保每列保持原子性，不可拆分成两个字段

第二范式：主键的设定要与列相关，确保每一列都和主键相关，而不是只能与主键的某一部分相关

第三范式：确保每列都和主键列直接相关，而不是间接相关

# 存储引擎

InnoDB MyIsAM Memory的区别

InnoDB 提供了良好的事务处理、崩溃修复能力和并发控制、支持行级锁。缺点是读写效率较差，占用的数据空间相对较大。

底层使用B+索引

MyIsAM
占用空间小，处理速度快，支持表级锁。缺点是不支持事务的完整性和并发性。 

索引：索引文件和数据文件是分离的，索引文件仅仅保存数据记录的地址。

底层使用B+索引。MyIsAM对数据进行压缩

MEMORY 
数据全部放在内存中，表结构存在磁盘文件中。默认使用哈希索引。

什么场景下选择使用？
如果系统插入和查询操作较多，不需要事务、外键。选择MYISAM
如果系统频繁的更新、删除操作，需要事务、外键、行级锁。使用INNODB

InnoDB的存储结构

所有的数据都被逻辑的存放在一个空间，成为表空间。表空间由页、区、段、组成。

页：InnoDB 将数据存储在页（Page）中，每一页默认大小为 16KB

区：页构建的区，一个区是物理位置上连续的64个页，因此便于顺序查找。由于一页是16k那么64个页在一起组成1M。所以我们应该尽量让链表中相邻的页的物理位置也相邻，这样进行范围查询的时候才可以使用所谓的顺序I/O。

段：叶子节点有自己独有的区，非叶子节点也有自己独有的区。**存放叶子节点的区的集合就算是一个****段****（****segment****），存放非叶子节点的区的集合也算是一个****段****。也就是说一个索引会生成2个段，一个叶子节点段，一个非叶子节点段。**

InnoDB逻辑存储结构由段（segment）、区（extent）、页（page）组成。以B+树为例，一个索引会生成2个段，一个**叶子节点段**，一个**非叶子节点段**。其中非叶子节点段（segment）由非叶子节点区（extent）组成，**区中存放着物理地址连续的索引页（page**）。当有另一个索引出现时，会以另一个extend形式存在于segment中。叶子节点段（segment）即存放着叶子节点区，区内包含着数据页。


# 索引

## 索引类型
B+树索引、哈希索引、全文索引、倒排索引
https://juejin.cn/post/6844904167060799501


## 1、索引结构

### 1.1 哈希索引
Hash表存储表数据Key可以存储索引列，Value 存储行记录或者磁盘地址。
优点：Hash表在等值查询时效率很高，时间复杂度为O(1)
缺点：不支持范围快速查询，范围查询的时候只能通过全表扫描的方式

### 1.2 B+树索引
为什么选择B+树索引？

日常对数据库的查找操作，主要有三类需求
1.  根据某个值精确快速查找
2.  根据区间的上下限来快速查找此区间的数据
3.  查询符合条件的记录并根据某些字段进行排序


Mysql使用的是用户态直接I/O(零拷贝)
Mysql的数据是存储在磁盘文件中的，在查询数据的时候，需要把磁盘中的数据加载到内存中，因为磁盘I/O 操作非常耗时，所以我们优化的重点就是尽量减少磁盘I/O 操作。
我们希望一次I/O可以读取较多的数据，而平衡二叉树是每个节点只存储一个键值和数据，也就是说，存储的时候，每个磁盘块只存储一个键值和数据。

读取磁盘数据的时候，都是按磁盘块来读取的（局部性原理与磁盘预读），并不是一条一条的读。在使用树这种结构作为索引的数据结构时，我们每查找一次数据就需要从磁盘中读取一个树节点，也就是对应的一个磁盘块，所以如果我们能把尽量多的数据放到磁盘块中，那么每次读取的数据就会较多。

为了达到这个效率，在每个节点上考虑存储较多的数据，这样就将二叉树改造成了多叉树，通过增加树的叉树，将树从高瘦变为矮胖。

B树
这种数据结构我们称为B树，B树是一种多叉平衡查找树，特点：

1.  B树的节点中存储着多个元素，每个内节点有多个分叉。
2.  节点中的元素包含索引和数据，节点中的键值从小到大排列。也就是说，在所有的节点都储存数据。可以直接访问到索引上的数据。
3.  **父节点当中的元素不会出现在子节点中**。
4.  **所有的叶子结点都位于同一层，叶节点具有相同的深度**，叶节点之间没有指针连接。

B树的缺点：

1）B树不支持范围查询的快速查找。如果查找10和35之间的数据，查找到15之后，需要回到根节点重新遍历查找，需要从根节点进行多次遍历，查询效率有待提高。

2）由于节点上都存储了索引和数据（行记录或者磁盘地址），如果data存储的是行记录，行的大小随着列数的增多，所占空间会变大。**这时，一个页中可存储的数据量就会变少，树相应就会变高**，磁盘IO次数就会变大。mysql 磁盘一次I\O操作读取一页数据量，默认16k


### B+树
特点：
只有叶子节点才会存储数据，非叶子节点只存储索引，这样一页可以存储更多非叶子节点，树的高度也会下降。

只有叶子节点才会存储数据，非叶子节点值

叶子节点之间使用双向指针链接，最底层的叶子节点形成了一个双向有序链表，很好的支持范围查询

B+ 树的特点：
1）一个节点存储着多个元素、每个内节点中又多个分叉
2）节点的元素只包含索引（键值，索引字段的值），节点的键值从小到大进行排序。
3）所有叶子节点都位于同一层，具有相同的深度，来保存全部的关键字，并且按顺序通过指针链接在一起。



## 索引分类

在关系型数据库中，常见的索引分类有以下几种：

1）主键索引：主键索引是一种特殊的索引，它是根据表的主键字段创建的索引。主键索引保证表中每行数据的唯一性，因此在查询和数据更新操作中非常重要。
2）唯一索引：唯一索引是根据唯一性约束字段创建的索引。唯一索引保证表中每行数据的唯一性，但允许空值。
3）普通索引：普通索引是根据表中的非唯一性字段创建的索引。普通索引可以加速对表中数据的查询和检索。
4）全文索引：全文索引是针对表中文本内容的索引，可以支持关键词搜索等功能。
5）组合索引：组合索引是根据多个字段组合创建的索引，可以提高多字段查询的效率。


### 组合索引

组合索引（Composite Index）是由多个列组成的索引，可以理解为多个单列索引的组合。组合索引中的每一个列都可以单独被查询，也可以通过组合索引查询多个列。组合索引的建立可以极大地优化多列条件下的查询性能。

组合索引结构可以看做是 B+ 树的一个分支，从根节点开始，通过各级节点的分裂和合并，找到包含索引值的叶子节点，然后定位到数据行的物理存储位置。
