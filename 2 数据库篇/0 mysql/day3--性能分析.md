# 索引下推

是 MySQL 5.6 发布后针对扫描二级索引的一项优化改进。

总的来说是通过把**索引过滤条件下推到存储引擎**，来减少 MySQL 存储引擎访问基表的次数以及 MySQL 服务层访问存储引擎的次数。

MySQL 存储引擎层，先根据过滤条件中**包含的索引键确定索引的区间**，再在这个区间的记录上使用包**含索引键的其他过滤条件进行过滤**，之后规避掉不满足的索引记录，只根据满足条件的索引记录回表取回数据上传到 MySQL 服务层。


mysql的存储引擎层，先根据过滤条件中包含的索引键确定索引。



#  性能分析方法、SQL性能优化和MySQL内部配置优化

https://www.jianshu.com/p/3c79039e82aa

1）硬件本身
MySQL数据库是常见的两个瓶颈是CPU和I/O的瓶颈。
io瓶颈：
1）热点数据太多，数据库缓存放不下，每次都要从磁盘重新IO
2）网络请求量大，网络带宽不够使用—>分库
cpu瓶颈：
1）频繁的复杂sql语句，比如子查询，增加cpu的运算
2）单表数据量太大，扫描行数过多，查询时间太长—>分表

  查看linux中cpu和IO
vmstat：可以展现给定时间间隔的服务器的状态值，包括服务器的CPU使用率，内存使用，虚拟内存交换情况，IO读写情况。
 iostat: 主要用于监控系统设备的IO负载情况

对于MySQL系统本身，我们可以使用工具来优化数据库的性能，通常有三种：使用索引，使用EXPLAIN分析查询以及调整MySQL的内部配置。


1）数据库性能分析

优化MySQL时，通常需要对数据库进行分析，常见的分析手段有慢查询日志，EXPLAIN 分析查询（表的读取顺序，索引的长度，包含哪些索引，在执行的sql中使用了哪些索引），profiling分析以及show命令查询系统状态及系统变量


慢日志查询可以知道哪些SQL语句执行效率低下，通过explain我们可以得知SQL语句的具体执行情况，索引使用等。同时还可以使用profiling找到更为详细的SQL执行消耗系统资源的信息。

2）索引构建-合理的建立索引

(1)  越小的数据类型通常更好：越小的数据类型通常在磁盘、内存和CPU缓存中都需要更少的空间，处理起来更快。

(2)  简单的数据类型更好：整型数据比起字符，处理开销更小，因为字符串的比较更复杂。在MySQL中，应该用内置的日期和时间数据类型，而不是用字符串来存储时间；以及用整型数据类型存储IP地址。

(3)  尽量避免NULL：应该指定列为NOT NULL，除非你想存储NULL。在MySQL中，含有空值的列很难进行查询优化，因为它们使得索引、索引的统计信息以及比较运算更加复杂。你应该用0、一个特殊的值或者一个空串代替空值。

  
  where条件使用注意：
  Ø where子句的查询条件里有！=，MySQL将无法使用索引。

Ø where子句使用了Mysql函数的时候，索引将无效，比如：select * from tb where left(name, 4) = ‘xxx’。

Ø 使用LIKE进行搜索匹配的时候，这样索引是有效的：select * from tbl1 where name like ‘xxx%’，而like ‘%xxx%’ 时索引无效

**Mysql内部配置优化**

1）最大连接数的设置，合理的设置最大连接数，按照服务器的性能进行调整，一个进程默认支持的最大文件描述符是1024，还需要修改文件描述符的上限。
2）


# 分表和分库

https://zhuanlan.zhihu.com/p/376513730